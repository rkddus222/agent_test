semantic_models:
  - name: transaction
    table: test_daquv('bank_transaction')
    description: 테이블(bank_transaction)을 기반으로 한 semantic 모델
    defaults:
      agg_time_dimension: tran_date

    entities:
      - name: transaction
        type: primary
        expr: id
      - name: account
        type: foreign
        expr: account_no
      - name: customer
        type: foreign
        expr: customer_id
      - name: branch
        type: foreign
        expr: branch_code

    dimensions:
      - name: account_no
        type: varchar
        label: 계좌 번호
        description: 계좌 번호
      - name: tran_type
        type: varchar
        label: 거래 종류
        description: 거래 종류 (입금, 출금, 이체 등)
      - name: currency
        type: varchar
        label: 거래 통화
        description: 거래 통화

      # 시간 차원
      - name: tran_datetime
        type: varchar
        label: 거래 발생 일시
        description: 거래 발생 일시 (YYYYMMDDHH24MISS 형식)
      - name: tran_date
        type: date
        label: 거래 발생 일자
        expr: TO_DATE(SUBSTR(tran_datetime, 1, 8), 'YYYYMMDD')
        type_params:
          time_granularity: day
        description: 거래 발생 일자 (YYYYMMDD)
      - name: tran_time
        type: varchar
        label: 거래 발생 시각
        expr: SUBSTR(tran_datetime, 9, 6)
        description: 거래 발생 시각 (HH24MISS)
      - name: tran_year
        type: varchar
        label: 거래 연도
        expr: SUBSTR(tran_datetime, 1, 4)
        description: 거래 발생 연도 (YYYY)
      - name: tran_month
        type: varchar
        label: 거래 월
        expr: SUBSTR(tran_datetime, 1, 6)
        description: 거래 발생 연월 (YYYYMM)

    measures:
      - name: transaction_count
        type: integer
        label: 거래 건수
        description: 거래 건수
        expr: id
      - name: amount
        type: integer
        label: 거래 금액
        description: 거래 금액
        expr: amount
      - name: balance
        type: integer
        label: 거래 후 잔액
        description: 거래 후 잔액
        expr: balance

metrics:
  - name: total_transaction_count
    description: 총 거래 건수
    type: integer
    metric_type: simple
    label: 총 거래 건수
    expr: COUNT_DISTINCT(transaction__transaction_count)
  - name: total_amount
    description: 총 거래 금액
    type: integer
    metric_type: simple
    label: 총 거래 금액
    expr: SUM(transaction__amount)
  - name: avg_amount
    description: 평균 거래 금액
    type: integer
    metric_type: simple
    label: 평균 거래 금액
    expr: AVG(transaction__amount)
